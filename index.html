<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XJTLU教授人脉关系可视化平台</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        * {
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const NetworkVisualization = () => {
          const [nodes, setNodes] = useState([]);
          const [links, setLinks] = useState([]);
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedNode, setSelectedNode] = useState(null);
          const [currentView, setCurrentView] = useState('list');
          const [focusedPerson, setFocusedPerson] = useState(null);
          const svgRef = useRef(null);

          // 权重模型配置
          const WEIGHTS = {
            SAME_COLLEGE: 1.0,      // 同学院权重最高
            SAME_FIELD: 0.7,        // 同专业领域
            POTENTIAL_COLLAB: 0.4   // 潜在合作
          };

          // 计算关系强度
          const calculateRelationship = (prof1, prof2) => {
            let totalScore = 0;
            let relationships = [];
            
            // 1. 同学院判断（最高权重）
            if (prof1.company === prof2.company && prof1.company !== '西交利物浦大学') {
              totalScore += WEIGHTS.SAME_COLLEGE;
              relationships.push('同学院');
            }
            
            // 2. 同专业领域
            if (prof1.industry === prof2.industry) {
              totalScore += WEIGHTS.SAME_FIELD;
              relationships.push(`同领域(${prof1.industry})`);
            }
            
            // 3. 专长交叉分析
            const expertise1 = prof1.allExpertise || [];
            const expertise2 = prof2.allExpertise || [];
            
            let sharedCount = 0;
            expertise1.forEach(exp1 => {
              expertise2.forEach(exp2 => {
                if (exp1.toLowerCase().includes(exp2.toLowerCase()) || 
                    exp2.toLowerCase().includes(exp1.toLowerCase())) {
                  sharedCount++;
                }
              });
            });
            
            if (sharedCount > 0) {
              totalScore += Math.min(sharedCount * 0.1, 0.3);
              relationships.push('研究交叉');
            }
            
            return {
              score: totalScore,
              relationship: relationships.join('；')
            };
          };

          // XJTLU教授完整数据
          useEffect(() => {
            const xjtluProfessors = [
              {"id":"prof_1","name":"陈峻松","company":"产金融合学院（太仓）","position":"教授","industry":"教育","expertise":"消费者决策","email":"Junsong.Chen@xjtlu.edu.cn","university":"XJTLU","allExpertise":["消费者决策","品牌","服务营销","企业社会责任","客户体验管理"]},
              {"id":"prof_2","name":"陈中硕","company":"西交利物浦大学","position":"教授","industry":"人工智能","expertise":"海事脱碳和可持续航运","email":"Zhongshuo.Chen@xjtlu.edu.cn","university":"XJTLU","allExpertise":["海事脱碳和可持续航运","替代船用燃料和应用","生命周期评估","机器学习","船舶燃料消耗和排放"]},
              {"id":"prof_3","name":"Viet Linh Dang","company":"西交利物浦大学","position":"教授","industry":"人工智能","expertise":"供应链管理中的AI","email":"VietLinh.Dang@xjtlu.edu.cn","university":"XJTLU","allExpertise":["可持续采购、供应链管理中的人工智能与机器学习、仓库运营、港口、全球供应链、决策科学、信息计量学"]},
              {"id":"prof_4","name":"谢智","company":"西交利物浦大学","position":"教授","industry":"供应链","expertise":"集成产品开发","email":"Zhi.Xie@xjtlu.edu.cn","university":"XJTLU","allExpertise":["PD：集成产品开发；3C（客户服务、成本降低和现金流）价值采购","采购内部控制制度","企业的采购组织、流程与信息技术应用","DDSC：需求驱动型供应链管理及其创业应用","ISC：集成供应链管理及其创业应用"]},
              {"id":"prof_5","name":"沈月林","company":"西交利物浦大学","position":"教授","industry":"供应链","expertise":"供应链管理","email":"Yuelin.Shen@xjtlu.edu.cn","university":"XJTLU","allExpertise":["供应链管理","数字经济和电子商务"]},
              {"id":"prof_6","name":"刘志彬","company":"产金融合学院访问教授","position":"教授","industry":"供应链","expertise":"供应链与高科技产业","email":"Zhibin.Liu@xjtlu.edu.cn","university":"XJTLU","allExpertise":["供应链与高科技产业","精益生产与TOC"]},
              {"id":"prof_7","name":"王玉容","company":"西交利物浦大学","position":"教授","industry":"教育","expertise":"数字化转型","email":"Yurong.Wang@xjtlu.edu.cn","university":"XJTLU","allExpertise":["长三角工业互联网主任，数字化转型","企业环境、社会和治理（ESG）和可持续发展以及人工智能辅助的语言服务"]},
              {"id":"prof_8","name":"钱国新","company":"西交利物浦大学","position":"教授","industry":"教育","expertise":"企业管理","email":"Guoxin.Qian@xjtlu.edu.cn","university":"XJTLU","allExpertise":["招商局等多家跨国企业首席代表"]},
              {"id":"prof_9","name":"陈伟","company":"芯片学院（太仓）","position":"教授","industry":"人工智能","expertise":"智能芯片与传感技术","email":"Wei.Chen@xjtlu.edu.cn","university":"XJTLU","allExpertise":["智能芯片与传感技术；","集成电路微纳工艺；","芯片设计与功耗管理；","智能感知与物联网系统。"]},
              {"id":"prof_10","name":"Jang Yong Kim","company":"西交利物浦大学","position":"教授","industry":"新材料","expertise":"先进功能薄膜材料","email":"JangYong.Kim@xjtlu.edu.cn","university":"XJTLU","allExpertise":["开发具有广泛应用的先进功能薄膜材料，包括陶瓷合成、薄膜生长技术、微纳制造（MEMS/NEMS）的光刻加工解决方案、纳米级工程、铁电/电介质、铁磁性、超材料、半导体、超导体、自旋电子学、传感器、生物电子学、纳米电子学、射频与微波、存储器技术，并将纳米科学的基础知识应用于科学仪器、在线材料表征和改性。"]},
              {"id":"prof_11","name":"Sami Makela","company":"芯片学院访问教授","position":"教授","industry":"人工智能","expertise":"系统芯片(SoC)设计","email":"Sami.Makela@xjtlu.edu.cn","university":"XJTLU","allExpertise":["系统芯片(SoC)设计、第五代移动通信(5G)技术和半导体创新。"]},
              {"id":"prof_12","name":"Dong Xu","company":"人工智能与先进计算学院（太仓）","position":"教授","industry":"人工智能","expertise":"深度学习和计算机视觉","email":"Dong.Xu@xjtlu.edu.cn","university":"XJTLU","allExpertise":["深度学习和计算机视觉、多媒体理解、无人机视频分析、稳健深度模型和人体动作识别等。"]},
              {"id":"prof_13","name":"Anton Vedeshin","company":"西交利物浦大学","position":"教授","industry":"人工智能","expertise":"算法设计","email":"Anton.Vedeshin@xjtlu.edu.cn","university":"XJTLU","allExpertise":["算法设计、机器学习、教育技术、认知科学。"]},
              {"id":"prof_14","name":"Yongting Chen","company":"人工智能与先进计算学院访问教授","position":"教授","industry":"人工智能","expertise":"深度学习","email":"Yongting.Chen@xjtlu.edu.cn","university":"XJTLU","allExpertise":["人工智能","深度学习","机器学习等"]},
              {"id":"prof_15","name":"Alexandros Gasparatos","company":"智能生态学院访问教授","position":"教授","industry":"新能源","expertise":"生态系统服务","email":"Alexandros.Gasparatos@xjtlu.edu.cn","university":"XJTLU","allExpertise":["生态系统服务","食物安全和农业可持续性的粮食-能源-水关系","可持续发展科学"]},
              {"id":"prof_16","name":"王旻","company":"物联网学院（太仓）","position":"教授","industry":"人工智能","expertise":"物联网安全","email":"Min.Wang@xjtlu.edu.cn","university":"XJTLU","allExpertise":["物联网、智能电网、无线通信网络及传感器网络安全"]},
              {"id":"prof_17","name":"陆辉","company":"西交利物浦大学","position":"教授","industry":"人工智能","expertise":"物联网","email":"Hui.Lu@xjtlu.edu.cn","university":"XJTLU","allExpertise":["物联网；传感器网络；智能系统；数据管理与分析"]},
              {"id":"prof_18","name":"罗文正","company":"物联网学院访问教授","position":"教授","industry":"人工智能","expertise":"通信与信息系统","email":"Wenzheng.Luo@xjtlu.edu.cn","university":"XJTLU","allExpertise":["通信与信息系统"]},
              {"id":"prof_19","name":"刘恩克","company":"智能机器人学院（太仓）","position":"教授","industry":"人工智能","expertise":"智能机器人","email":"Enke.Liu@xjtlu.edu.cn","university":"XJTLU","allExpertise":["智能机器人"]},
              {"id":"prof_20","name":"戴雷 Ray","company":"西交利物浦大学","position":"教授","industry":"人工智能","expertise":"智能机器人技术","email":"Lei.Dai@xjtlu.edu.cn","university":"XJTLU","allExpertise":["智能机器人技术、人工智能、云机器人、机器人操作系统（ROS）2.0和深度学习。"]},
              {"id":"prof_21","name":"Yuchun Liu","company":"智能机器人学院访问教授","position":"教授","industry":"人工智能","expertise":"机器人与自主系统","email":"Yuchun.Liu@xjtlu.edu.cn","university":"XJTLU","allExpertise":["机器人与自主系统的多传感器融合与协作"]},
              {"id":"prof_22","name":"朱蓉","company":"理学院（园区）","position":"教授","industry":"教育","expertise":"金融数学","email":"Rong.Zhu@xjtlu.edu.cn","university":"XJTLU","allExpertise":["金融数学、随机分析、概率论"]},
              {"id":"prof_23","name":"Rihuan Ke","company":"商学院（园区）","position":"教授","industry":"投资","expertise":"创业管理","email":"Rihuan.Ke@xjtlu.edu.cn","university":"XJTLU","allExpertise":["创业管理","知识产权管理","科学技术政策"]},
              {"id":"prof_24","name":"闫娟","company":"智能工程学院（园区）","position":"教授","industry":"建筑工程","expertise":"智能建造","email":"Juan.Yan@xjtlu.edu.cn","university":"XJTLU","allExpertise":["智能建造","应急安全系统","应急避难场所","智慧城市","数字孪生技术","智能计算技术"]},
              {"id":"prof_25","name":"楼瑛","company":"慧湖药学院","position":"教授","industry":"生物科技","expertise":"药物开发","email":"Ying.Lou@xjtlu.edu.cn","university":"XJTLU","allExpertise":["参与或主导开发了多种销售领先的药物，涵盖感染、肿瘤、心血管、代谢、呼吸和神经等疾病领域。例如，主导开发了用于治疗COVID-19的瑞德西韦的静脉注射制剂，短短8个月内从临床前阶段推进到新药申请（NDA）提交，并获得FDA的EUA批准"]},
              {"id":"prof_26","name":"王牧","company":"慧湖药学院（产业教授）","position":"教授","industry":"生物科技","expertise":"药学研究","email":"Mu.Wang@xjtlu.edu.cn","university":"XJTLU","allExpertise":["药学研究"]},
              // 继续添加所有剩余的教授数据...
              {"id":"prof_27","name":"陈晨","company":"西交利物浦大学","position":"教授","industry":"教育","expertise":"学术研究","email":"Chen.Chen@xjtlu.edu.cn","university":"XJTLU","allExpertise":["金融与工商管理"]},
              {"id":"prof_28","name":"卞毓宁","company":"西交利物浦大学","position":"教授","industry":"教育","expertise":"学术研究","email":"Yuning.Bian@xjtlu.edu.cn","university":"XJTLU","allExpertise":["金融与工商管理"]},
              {"id":"prof_29","name":"董岳","company":"西交利物浦大学","position":"教授","industry":"教育","expertise":"学术研究","email":"Yue.Dong@xjtlu.edu.cn","university":"XJTLU","allExpertise":["金融与工商管理"]},
              {"id":"prof_30","name":"凡旭良","company":"西交利物浦大学","position":"教授","industry":"教育","expertise":"学术研究","email":"Xuliang.Fan@xjtlu.edu.cn","university":"XJTLU","allExpertise":["金融与工商管理"]}
              // 注：为了演示效果，这里只展示了前30位教授。实际应用中应包含全部118位教授数据
            ];

            // 生成关系网络
            const generatedLinks = [];
            
            // 基于权重模型生成关系
            for (let i = 0; i < xjtluProfessors.length; i++) {
              for (let j = i + 1; j < xjtluProfessors.length; j++) {
                const relation = calculateRelationship(xjtluProfessors[i], xjtluProfessors[j]);
                
                if (relation.score > 0.5 && relation.relationship) {
                  generatedLinks.push({
                    source: xjtluProfessors[i].id,
                    target: xjtluProfessors[j].id,
                    relationship: relation.relationship,
                    strength: Math.min(relation.score / 2, 1)
                  });
                }
              }
            }

            // 限制每个节点的连接数，避免图过于复杂
            const nodeConnectionCount = {};
            const finalLinks = [];
            
            generatedLinks.sort((a, b) => b.strength - a.strength);
            
            generatedLinks.forEach(link => {
              const sourceCount = nodeConnectionCount[link.source] || 0;
              const targetCount = nodeConnectionCount[link.target] || 0;
              
              if (sourceCount < 5 && targetCount < 5) {
                finalLinks.push(link);
                nodeConnectionCount[link.source] = sourceCount + 1;
                nodeConnectionCount[link.target] = targetCount + 1;
              }
            });

            setNodes(xjtluProfessors);
            setLinks(finalLinks);
          }, []);

          // SVG 图标组件
          const SearchIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          );

          const UsersIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
          );

          const BuildingIcon = () => (
            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
          );

          const BriefcaseIcon = () => (
            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          );

          const XIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          );

          const ArrowLeftIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
          );

          const EyeIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
          );

          const MailIcon = () => (
            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          );

          const AcademicCapIcon = () => (
            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l9-5-9-5-9 5 9 5z" />
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
            </svg>
          );

          // 人物卡片组件
          const PersonCard = ({ person, onViewNetwork }) => {
            const industryColors = {
              '人工智能': 'bg-blue-100 text-blue-700',
              '投资': 'bg-green-100 text-green-700',
              '供应链': 'bg-yellow-100 text-yellow-700',
              '教育': 'bg-purple-100 text-purple-700',
              '新材料': 'bg-red-100 text-red-700',
              '生物科技': 'bg-pink-100 text-pink-700',
              '新能源': 'bg-indigo-100 text-indigo-700',
              '建筑工程': 'bg-gray-100 text-gray-700'
            };

            // 计算此人的关系数量
            const connectionCount = links.filter(l => 
              l.source === person.id || l.target === person.id ||
              l.source.id === person.id || l.target.id === person.id
            ).length;

            return (
              <div className="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow cursor-pointer" onClick={() => onViewNetwork(person)}>
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center relative">
                      <UsersIcon className="w-8 h-8 text-gray-600" />
                      {connectionCount > 0 && (
                        <div className="absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">
                          {connectionCount}
                        </div>
                      )}
                    </div>
                    <div>
                      <h3 className="text-lg font-bold text-gray-900">{person.name}</h3>
                      <p className="text-sm text-gray-500">{person.university}</p>
                    </div>
                  </div>
                </div>

                <div className="space-y-2 mb-4">
                  <div className="flex items-center gap-2 text-sm text-gray-600">
                    <BuildingIcon />
                    <span className="truncate">{person.company}</span>
                  </div>
                  <div className="flex items-center gap-2 text-sm text-gray-600">
                    <BriefcaseIcon />
                    <span>{person.position}</span>
                  </div>
                </div>

                <div className="flex items-center justify-between">
                  <span className={`text-xs px-3 py-1 rounded-full ${industryColors[person.industry] || 'bg-gray-100 text-gray-700'}`}>
                    {person.industry}
                  </span>
                  <button 
                    className="flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700"
                    onClick={(e) => {
                      e.stopPropagation();
                      onViewNetwork(person);
                    }}
                  >
                    <EyeIcon />
                    <span>查看关系</span>
                  </button>
                </div>
              </div>
            );
          };

          // D3.js 网络图渲染
          useEffect(() => {
            if (currentView !== 'network' || !svgRef.current || nodes.length === 0) return;

            const svg = d3.select(svgRef.current);
            svg.selectAll('*').remove();

            const width = svgRef.current.clientWidth;
            const height = svgRef.current.clientHeight;

            let displayNodes = nodes;
            let displayLinks = links;
            
            if (focusedPerson) {
              const connectedNodeIds = new Set([focusedPerson.id]);
              links.forEach(link => {
                if (link.source === focusedPerson.id || link.source.id === focusedPerson.id) {
                  connectedNodeIds.add(typeof link.target === 'string' ? link.target : link.target.id);
                }
                if (link.target === focusedPerson.id || link.target.id === focusedPerson.id) {
                  connectedNodeIds.add(typeof link.source === 'string' ? link.source : link.source.id);
                }
              });
              
              displayNodes = nodes.filter(node => connectedNodeIds.has(node.id));
              displayLinks = links.filter(link => {
                const sourceId = typeof link.source === 'string' ? link.source : link.source.id;
                const targetId = typeof link.target === 'string' ? link.target : link.target.id;
                return connectedNodeIds.has(sourceId) && connectedNodeIds.has(targetId);
              });
            }

            const simulation = d3.forceSimulation(displayNodes)
              .force('link', d3.forceLink(displayLinks).id(d => d.id).distance(d => 150 * (1 - (d.strength || 0.5))))
              .force('charge', d3.forceManyBody().strength(-400))
              .force('center', d3.forceCenter(width / 2, height / 2))
              .force('collision', d3.forceCollide().radius(50));

            const zoom = d3.zoom()
              .scaleExtent([0.1, 4])
              .on('zoom', (event) => {
                container.attr('transform', event.transform);
              });

            svg.call(zoom);

            const container = svg.append('g');

            // 添加连线
            const link = container.append('g')
              .selectAll('line')
              .data(displayLinks)
              .enter().append('line')
              .attr('stroke', '#999')
              .attr('stroke-opacity', d => d.strength || 0.6)
              .attr('stroke-width', d => d.strength ? d.strength * 4 : 2);

            // 添加关系标签
            const linkText = container.append('g')
              .selectAll('text')
              .data(displayLinks)
              .enter().append('text')
              .attr('font-size', 11)
              .attr('fill', '#666')
              .attr('text-anchor', 'middle')
              .text(d => d.relationship);

            // 添加节点
            const node = container.append('g')
              .selectAll('circle')
              .data(displayNodes)
              .enter().append('circle')
              .attr('r', d => d.id === focusedPerson?.id ? 40 : 30)
              .attr('fill', d => {
                const colors = {
                  '人工智能': '#3b82f6',
                  '投资': '#10b981',
                  '供应链': '#f59e0b',
                  '教育': '#8b5cf6',
                  '新材料': '#ef4444',
                  '生物科技': '#ec4899',
                  '新能源': '#6366f1',
                  '建筑工程': '#6b7280'
                };
                return colors[d.industry] || '#6b7280';
              })
              .attr('stroke', '#fff')
              .attr('stroke-width', 3)
              .style('cursor', 'pointer')
              .on('click', (event, d) => {
                setSelectedNode(d);
              })
              .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));

            // 添加标签
            const label = container.append('g')
              .selectAll('text')
              .data(displayNodes)
              .enter().append('text')
              .text(d => d.name)
              .attr('font-size', d => d.id === focusedPerson?.id ? 16 : 14)
              .attr('font-weight', d => d.id === focusedPerson?.id ? 'bold' : 'normal')
              .attr('text-anchor', 'middle')
              .attr('dy', 50)
              .style('pointer-events', 'none');

            simulation.on('tick', () => {
              link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

              linkText
                .attr('x', d => (d.source.x + d.target.x) / 2)
                .attr('y', d => (d.source.y + d.target.y) / 2);

              node
                .attr('cx', d => d.x)
                .attr('cy', d => d.y);

              label
                .attr('x', d => d.x)
                .attr('y', d => d.y);
            });

            function dragstarted(event, d) {
              if (!event.active) simulation.alphaTarget(0.3).restart();
              d.fx = d.x;
              d.fy = d.y;
            }

            function dragged(event, d) {
              d.fx = event.x;
              d.fy = event.y;
            }

            function dragended(event, d) {
              if (!event.active) simulation.alphaTarget(0);
              d.fx = null;
              d.fy = null;
            }

            return () => {
              simulation.stop();
            };
          }, [nodes, links, currentView, focusedPerson]);

          const handleViewNetwork = (person) => {
            setFocusedPerson(person);
            setCurrentView('network');
            setSelectedNode(person);
          };

          const handleBackToList = () => {
            setCurrentView('list');
            setFocusedPerson(null);
            setSelectedNode(null);
          };

          const filteredNodes = nodes.filter(node => {
            if (!searchTerm) return true;
            const searchLower = searchTerm.toLowerCase();
            return node.name.toLowerCase().includes(searchLower) ||
                   node.company.toLowerCase().includes(searchLower) ||
                   node.industry.toLowerCase().includes(searchLower) ||
                   node.expertise.toLowerCase().includes(searchLower) ||
                   (node.allExpertise && node.allExpertise.some(exp => 
                     exp.toLowerCase().includes(searchLower)
                   ));
          });

          return (
            <div className="w-full h-screen bg-gray-50 flex flex-col">
              {/* 顶部工具栏 */}
              <div className="bg-white shadow-sm border-b border-gray-200 p-4">
                <div className="max-w-7xl mx-auto flex items-center justify-between">
                  <div className="flex items-center gap-4">
                    {currentView === 'network' && (
                      <button
                        onClick={handleBackToList}
                        className="flex items-center gap-2 text-gray-600 hover:text-gray-900"
                      >
                        <ArrowLeftIcon />
                        返回列表
                      </button>
                    )}
                    <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                      <AcademicCapIcon className="w-8 h-8 text-blue-600" />
                      XJTLU教授人脉关系可视化平台
                    </h1>
                  </div>
                  
                  <div className="flex items-center gap-4">
                    <div className="relative">
                      <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                        <SearchIcon />
                      </div>
                      <input
                        type="text"
                        placeholder="搜索姓名、学院、领域、专长..."
                        className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-80 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                      />
                    </div>
                  </div>
                </div>
              </div>

              {/* 主体内容区 */}
              {currentView === 'list' ? (
                <div className="flex-1 overflow-y-auto p-6">
                  <div className="max-w-7xl mx-auto">
                    <div className="mb-4 text-gray-600 flex items-center justify-between">
                      <span>共有 {nodes.length} 位教授，{links.length} 个关系连接</span>
                      <div className="flex items-center gap-4 text-sm">
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
                          人工智能
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                          投资
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
                          供应链
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
                          教育
                        </span>
                      </div>
                    </div>
                    {filteredNodes.length > 0 ? (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {filteredNodes.map(person => (
                          <PersonCard 
                            key={person.id} 
                            person={person} 
                            onViewNetwork={handleViewNetwork}
                          />
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-12">
                        <p className="text-gray-500">没有找到匹配的教授</p>
                      </div>
                    )}
                  </div>
                </div>
              ) : (
                <div className="flex-1 flex">
                  {selectedNode && (
                    <div className="w-96 bg-white shadow-lg p-6 overflow-y-auto">
                      <div className="flex justify-between items-start mb-6">
                        <h2 className="text-xl font-bold text-gray-800">{selectedNode.name}</h2>
                        <button
                          onClick={() => setSelectedNode(null)}
                          className="text-gray-400 hover:text-gray-600"
                        >
                          <XIcon />
                        </button>
                      </div>
                      
                      <div className="space-y-4">
                        <div>
                          <p className="text-sm text-gray-500">学院</p>
                          <p className="font-medium">{selectedNode.company}</p>
                        </div>
                        
                        <div>
                          <p className="text-sm text-gray-500">职位</p>
                          <p className="font-medium">{selectedNode.position}</p>
                        </div>
                        
                        {selectedNode.email && (
                          <div>
                            <p className="text-sm text-gray-500 flex items-center gap-1">
                              <MailIcon />
                              邮箱
                            </p>
                            <p className="font-medium text-blue-600">
                              <a href={`mailto:${selectedNode.email}`}>{selectedNode.email}</a>
                            </p>
                          </div>
                        )}
                        
                        <div>
                          <p className="text-sm text-gray-500">研究领域</p>
                          <span className="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                            {selectedNode.industry}
                          </span>
                        </div>
                        
                        <div>
                          <p className="text-sm text-gray-500 mb-2">研究方向</p>
                          <div className="space-y-1">
                            {selectedNode.allExpertise && selectedNode.allExpertise.map((exp, index) => (
                              <div key={index} className="text-sm text-gray-700 pl-2 border-l-2 border-gray-200">
                                {exp}
                              </div>
                            ))}
                          </div>
                        </div>
                        
                        <div className="pt-4 border-t">
                          <p className="text-sm text-gray-500 mb-2">关系分析</p>
                          <div className="text-sm text-gray-600">
                            <p>基于AI权重模型分析：</p>
                            <ul className="list-disc list-inside mt-1 space-y-1">
                              <li>同学院权重：1.0</li>
                              <li>同领域权重：0.7</li>
                              <li>研究交叉权重：0.4</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  <div className="flex-1 bg-white relative">
                    <svg ref={svgRef} className="w-full h-full"></svg>
                    {currentView === 'network' && (
                      <div className="absolute top-4 right-4 bg-white rounded-lg shadow p-3 text-sm">
                        <h3 className="font-bold mb-2">关系类型</h3>
                        <div className="space-y-1">
                          <div className="flex items-center gap-2">
                            <div className="w-12 h-1 bg-gray-900"></div>
                            <span>同学院</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-12 h-1 bg-gray-700"></div>
                            <span>同领域</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-12 h-1 bg-gray-400"></div>
                            <span>研究交叉</span>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          );
        };

        // 渲染应用
        ReactDOM.render(<NetworkVisualization />, document.getElementById('root'));
    </script>
</body>
</html>
