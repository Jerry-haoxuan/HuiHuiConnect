<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>精尚慧Ai人脉关系可视化平台</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        * {
            box-sizing: border-box;
        }
        .tree-link {
            fill: none;
            stroke: #ccc;
            stroke-width: 2px;
        }
        .tree-link.strong {
            stroke: #666;
            stroke-width: 3px;
        }
        .tree-node {
            cursor: pointer;
        }
        .tree-node circle {
            fill: #fff;
            stroke-width: 3px;
        }
        .tree-node text {
            font: 12px sans-serif;
        }
        .tree-node.internal circle {
            fill: #fff;
        }
        .tree-node.leaf circle {
            fill: #fff;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const NetworkVisualization = () => {
          const [nodes, setNodes] = useState([]);
          const [links, setLinks] = useState([]);
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedNode, setSelectedNode] = useState(null);
          const [currentView, setCurrentView] = useState('list');
          const [focusedPerson, setFocusedPerson] = useState(null);
          const svgRef = useRef(null);

          // 权重模型配置
          const WEIGHTS = {
            SAME_COLLEGE: 1.0,      // 同学院权重最高
            SAME_FIELD: 0.7,        // 同专业领域
            POTENTIAL_COLLAB: 0.4   // 潜在合作
          };

          // 计算关系强度
          const calculateRelationship = (prof1, prof2) => {
            let totalScore = 0;
            let relationships = [];
            
            // 1. 同学院判断（最高权重）
            if (prof1.company === prof2.company && prof1.company !== '西交利物浦大学') {
              totalScore += WEIGHTS.SAME_COLLEGE;
              relationships.push('同学院');
            }
            
            // 2. 同专业领域
            if (prof1.industry === prof2.industry) {
              totalScore += WEIGHTS.SAME_FIELD;
              relationships.push(`同领域(${prof1.industry})`);
            }
            
            // 3. 专长交叉分析
            const expertise1 = prof1.allExpertise || [];
            const expertise2 = prof2.allExpertise || [];
            
            let sharedCount = 0;
            expertise1.forEach(exp1 => {
              expertise2.forEach(exp2 => {
                if (exp1.toLowerCase().includes(exp2.toLowerCase()) || 
                    exp2.toLowerCase().includes(exp1.toLowerCase())) {
                  sharedCount++;
                }
              });
            });
            
            if (sharedCount > 0) {
              totalScore += Math.min(sharedCount * 0.1, 0.3);
              relationships.push('研究交叉');
            }
            
            return {
              score: totalScore,
              relationship: relationships.join('；')
            };
          };

          // XJTLU教授完整数据（示例数据，实际使用时需要完整118位）
          useEffect(() => {
            const xjtluProfessors = [
              {
                id: "prof_1",
                name: "陈峻松",
                company: "产金融合学院（太仓）",
                position: "教授",
                industry: "教育",
                expertise: "消费者决策",
                email: "Junsong.Chen@xjtlu.edu.cn",
                university: "XJTLU",
                allExpertise: ["消费者决策","品牌","服务营销","企业社会责任","客户体验管理"]
              },
              {
                id: "prof_2",
                name: "陈中硕",
                company: "西交利物浦大学",
                position: "教授",
                industry: "人工智能",
                expertise: "海事脱碳和可持续航运",
                email: "Zhongshuo.Chen@xjtlu.edu.cn",
                university: "XJTLU",
                allExpertise: ["海事脱碳和可持续航运","替代船用燃料和应用","生命周期评估","机器学习","船舶燃料消耗和排放"]
              },
              {
                id: "prof_3",
                name: "Viet Linh Dang",
                company: "西交利物浦大学",
                position: "教授",
                industry: "人工智能",
                expertise: "可持续采购、供应链管理中的人工智能与机器学习",
                email: "VietLinh.Dang@xjtlu.edu.cn",
                university: "XJTLU",
                allExpertise: ["可持续采购、供应链管理中的人工智能与机器学习、仓库运营、港口、全球供应链、决策科学、信息计量学"]
              },
              {
                id: "prof_4",
                name: "谢智",
                company: "西交利物浦大学",
                position: "教授",
                industry: "供应链",
                expertise: "集成产品开发",
                email: "Zhi.Xie@xjtlu.edu.cn",
                university: "XJTLU",
                allExpertise: ["PD：集成产品开发；3C（客户服务、成本降低和现金流）价值采购","采购内部控制制度","企业的采购组织、流程与信息技术应用"]
              },
              {
                id: "prof_5",
                name: "沈月林",
                company: "西交利物浦大学",
                position: "教授",
                industry: "供应链",
                expertise: "供应链管理",
                email: "Yuelin.Shen@xjtlu.edu.cn",
                university: "XJTLU",
                allExpertise: ["供应链管理","数字经济和电子商务"]
              }
              // 注意：这里仅展示5位教授作为示例
              // 实际部署时需要包含全部118位教授数据
            ];

            // 生成关系网络
            const generatedLinks = [];
            
            // 基于权重模型生成关系
            for (let i = 0; i < xjtluProfessors.length; i++) {
              for (let j = i + 1; j < xjtluProfessors.length; j++) {
                const relation = calculateRelationship(xjtluProfessors[i], xjtluProfessors[j]);
                
                if (relation.score > 0.5 && relation.relationship) {
                  generatedLinks.push({
                    source: xjtluProfessors[i].id,
                    target: xjtluProfessors[j].id,
                    relationship: relation.relationship,
                    strength: Math.min(relation.score / 2, 1)
                  });
                }
              }
            }

            // 限制每个节点的连接数
            const nodeConnectionCount = {};
            const finalLinks = [];
            
            generatedLinks.sort((a, b) => b.strength - a.strength);
            
            generatedLinks.forEach(link => {
              const sourceCount = nodeConnectionCount[link.source] || 0;
              const targetCount = nodeConnectionCount[link.target] || 0;
              
              if (sourceCount < 5 && targetCount < 5) {
                finalLinks.push(link);
                nodeConnectionCount[link.source] = sourceCount + 1;
                nodeConnectionCount[link.target] = targetCount + 1;
              }
            });

            setNodes(xjtluProfessors);
            setLinks(finalLinks);
          }, []);

          // SVG 图标组件
          const SearchIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          );

          const UsersIcon = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
          );

          const BuildingIcon = () => (
            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
          );

          const BriefcaseIcon = () => (
            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          );

          const XIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          );

          const ArrowLeftIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
          );

          const EyeIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
          );

          const SparklesIcon = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
          );

          // 人物卡片组件
          const PersonCard = ({ person, onViewNetwork }) => {
            const industryColors = {
              '人工智能': 'bg-blue-100 text-blue-700',
              '投资': 'bg-green-100 text-green-700',
              '供应链': 'bg-yellow-100 text-yellow-700',
              '教育': 'bg-purple-100 text-purple-700',
              '新材料': 'bg-red-100 text-red-700',
              '生物科技': 'bg-pink-100 text-pink-700',
              '新能源': 'bg-indigo-100 text-indigo-700',
              '建筑工程': 'bg-gray-100 text-gray-700'
            };

            const connectionCount = links.filter(l => 
              l.source === person.id || l.target === person.id ||
              l.source.id === person.id || l.target.id === person.id
            ).length;

            return (
              <div className="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow cursor-pointer" onClick={() => onViewNetwork(person)}>
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center relative">
                      <UsersIcon className="w-8 h-8 text-gray-600" />
                      {connectionCount > 0 && (
                        <div className="absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">
                          {connectionCount}
                        </div>
                      )}
                    </div>
                    <div>
                      <h3 className="text-lg font-bold text-gray-900">{person.name}</h3>
                      <p className="text-sm text-gray-500">{person.university}</p>
                    </div>
                  </div>
                </div>

                <div className="space-y-2 mb-4">
                  <div className="flex items-center gap-2 text-sm text-gray-600">
                    <BuildingIcon />
                    <span className="truncate">{person.company}</span>
                  </div>
                  <div className="flex items-center gap-2 text-sm text-gray-600">
                    <BriefcaseIcon />
                    <span>{person.position}</span>
                  </div>
                </div>

                <div className="flex items-center justify-between">
                  <span className={`text-xs px-3 py-1 rounded-full ${industryColors[person.industry] || 'bg-gray-100 text-gray-700'}`}>
                    {person.industry}
                  </span>
                  <button 
                    className="flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700"
                    onClick={(e) => {
                      e.stopPropagation();
                      onViewNetwork(person);
                    }}
                  >
                    <EyeIcon />
                    <span>查看关系</span>
                  </button>
                </div>
              </div>
            );
          };

          // 树形布局D3.js渲染
          useEffect(() => {
            if (currentView !== 'network' || !svgRef.current || nodes.length === 0 || !focusedPerson) return;

            const svg = d3.select(svgRef.current);
            svg.selectAll('*').remove();

            const width = svgRef.current.clientWidth;
            const height = svgRef.current.clientHeight;
            const margin = { top: 100, right: 200, bottom: 100, left: 200 };

            // 获取与焦点人物相关的节点和链接
            const relatedLinks = links.filter(link => 
              link.source === focusedPerson.id || link.target === focusedPerson.id
            );

            const relatedNodeIds = new Set([focusedPerson.id]);
            relatedLinks.forEach(link => {
              relatedNodeIds.add(link.source);
              relatedNodeIds.add(link.target);
            });

            const relatedNodes = nodes.filter(node => relatedNodeIds.has(node.id));

            // 构建树形数据结构
            const treeData = {
              id: focusedPerson.id,
              name: focusedPerson.name,
              data: focusedPerson,
              children: []
            };

            // 根据关系强度排序并添加子节点
            relatedLinks
              .sort((a, b) => b.strength - a.strength)
              .forEach(link => {
                const childId = link.source === focusedPerson.id ? link.target : link.source;
                const childNode = relatedNodes.find(n => n.id === childId);
                if (childNode) {
                  treeData.children.push({
                    id: childNode.id,
                    name: childNode.name,
                    data: childNode,
                    relationship: link.relationship,
                    strength: link.strength
                  });
                }
              });

            // 创建树形布局
            const treeLayout = d3.tree()
              .size([height - margin.top - margin.bottom, width - margin.left - margin.right])
              .separation((a, b) => 2);

            const root = d3.hierarchy(treeData);
            const treeNodes = treeLayout(root);

            // 创建缩放功能
            const zoom = d3.zoom()
              .scaleExtent([0.1, 4])
              .on('zoom', (event) => {
                container.attr('transform', event.transform);
              });

            svg.call(zoom);

            const container = svg.append('g')
              .attr('transform', `translate(${margin.left},${margin.top})`);

            // 绘制连线
            const link = container.selectAll('.tree-link')
              .data(root.links())
              .enter().append('path')
              .attr('class', d => `tree-link ${d.target.data.strength > 0.7 ? 'strong' : ''}`)
              .attr('d', d => {
                return `M${d.source.y},${d.source.x}
                        C${(d.source.y + d.target.y) / 2},${d.source.x}
                        ${(d.source.y + d.target.y) / 2},${d.target.x}
                        ${d.target.y},${d.target.x}`;
              });

            // 添加关系标签
            const linkLabel = container.selectAll('.link-label')
              .data(root.links())
              .enter().append('text')
              .attr('class', 'link-label')
              .attr('x', d => (d.source.y + d.target.y) / 2)
              .attr('y', d => (d.source.x + d.target.x) / 2)
              .attr('text-anchor', 'middle')
              .attr('dy', -5)
              .style('font-size', '12px')
              .style('fill', '#666')
              .text(d => d.target.data.relationship || '');

            // 绘制节点
            const node = container.selectAll('.tree-node')
              .data(root.descendants())
              .enter().append('g')
              .attr('class', 'tree-node')
              .attr('transform', d => `translate(${d.y},${d.x})`)
              .on('click', (event, d) => {
                if (d.data.data) {
                  setSelectedNode(d.data.data);
                }
              });

            // 节点圆圈
            node.append('circle')
              .attr('r', d => d.depth === 0 ? 40 : 30)
              .style('fill', d => {
                const colors = {
                  '人工智能': '#3b82f6',
                  '投资': '#10b981',
                  '供应链': '#f59e0b',
                  '教育': '#8b5cf6',
                  '新材料': '#ef4444',
                  '生物科技': '#ec4899',
                  '新能源': '#6366f1',
                  '建筑工程': '#6b7280'
                };
                return colors[d.data.data?.industry] || '#6b7280';
              });

            // 节点文本
            node.append('text')
              .attr('dy', d => d.depth === 0 ? 55 : 45)
              .attr('text-anchor', 'middle')
              .style('font-weight', d => d.depth === 0 ? 'bold' : 'normal')
              .style('font-size', d => d.depth === 0 ? '16px' : '14px')
              .text(d => d.data.name);

            // 添加学院标签
            node.append('text')
              .attr('dy', d => d.depth === 0 ? 70 : 60)
              .attr('text-anchor', 'middle')
              .style('font-size', '11px')
              .style('fill', '#666')
              .text(d => d.data.data?.company || '');

            // 初始缩放以适应内容
            const bounds = container.node().getBBox();
            const fullWidth = width;
            const fullHeight = height;
            const widthScale = fullWidth / bounds.width;
            const heightScale = fullHeight / bounds.height;
            const scale = 0.8 * Math.min(widthScale, heightScale);
            const translate = [fullWidth / 2 - scale * (bounds.x + bounds.width / 2), fullHeight / 2 - scale * (bounds.y + bounds.height / 2)];
            
            svg.call(zoom.transform, d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale));

          }, [nodes, links, currentView, focusedPerson]);

          const handleViewNetwork = (person) => {
            setFocusedPerson(person);
            setCurrentView('network');
            setSelectedNode(person);
          };

          const handleBackToList = () => {
            setCurrentView('list');
            setFocusedPerson(null);
            setSelectedNode(null);
          };

          const filteredNodes = nodes.filter(node => {
            if (!searchTerm) return true;
            const searchLower = searchTerm.toLowerCase();
            return node.name.toLowerCase().includes(searchLower) ||
                   node.company.toLowerCase().includes(searchLower) ||
                   node.industry.toLowerCase().includes(searchLower) ||
                   node.expertise.toLowerCase().includes(searchLower) ||
                   (node.allExpertise && node.allExpertise.some(exp => 
                     exp.toLowerCase().includes(searchLower)
                   ));
          });

          return (
            <div className="w-full h-screen bg-gray-50 flex flex-col">
              {/* 顶部工具栏 */}
              <div className="bg-white shadow-sm border-b border-gray-200 p-4">
                <div className="max-w-7xl mx-auto flex items-center justify-between">
                  <div className="flex items-center gap-4">
                    {currentView === 'network' && (
                      <button
                        onClick={handleBackToList}
                        className="flex items-center gap-2 text-gray-600 hover:text-gray-900"
                      >
                        <ArrowLeftIcon />
                        返回列表
                      </button>
                    )}
                    <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                      <SparklesIcon className="w-8 h-8 text-blue-600" />
                      精尚慧Ai人脉关系可视化平台
                    </h1>
                  </div>
                  
                  <div className="flex items-center gap-4">
                    <div className="relative">
                      <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                        <SearchIcon />
                      </div>
                      <input
                        type="text"
                        placeholder="搜索姓名、学院、领域、专长..."
                        className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-80 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                      />
                    </div>
                  </div>
                </div>
              </div>

              {/* 主体内容区 */}
              {currentView === 'list' ? (
                <div className="flex-1 overflow-y-auto p-6">
                  <div className="max-w-7xl mx-auto">
                    <div className="mb-4 text-gray-600 flex items-center justify-between">
                      <span>共有 {nodes.length} 位教授，{links.length} 个关系连接</span>
                      <div className="flex items-center gap-4 text-sm">
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
                          人工智能
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                          投资
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
                          供应链
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
                          教育
                        </span>
                        <span className="flex items-center gap-2">
                          <div className="w-3 h-3 bg-pink-500 rounded-full"></div>
                          生物科技
                        </span>
                      </div>
                    </div>
                    {filteredNodes.length > 0 ? (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {filteredNodes.map(person => (
                          <PersonCard 
                            key={person.id} 
                            person={person} 
                            onViewNetwork={handleViewNetwork}
                          />
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-12">
                        <p className="text-gray-500">没有找到匹配的教授</p>
                      </div>
                    )}
                  </div>
                </div>
              ) : (
                <div className="flex-1 flex">
                  {selectedNode && (
                    <div className="w-96 bg-white shadow-lg p-6 overflow-y-auto">
                      <div className="flex justify-between items-start mb-6">
                        <h2 className="text-xl font-bold text-gray-800">{selectedNode.name}</h2>
                        <button
                          onClick={() => setSelectedNode(null)}
                          className="text-gray-400 hover:text-gray-600"
                        >
                          <XIcon />
                        </button>
                      </div>
                      
                      <div className="space-y-4">
                        <div>
                          <p className="text-sm text-gray-500">学院</p>
                          <p className="font-medium">{selectedNode.company}</p>
                        </div>
                        
                        <div>
                          <p className="text-sm text-gray-500">职位</p>
                          <p className="font-medium">{selectedNode.position}</p>
                        </div>
                        
                        <div>
                          <p className="text-sm text-gray-500">研究领域</p>
                          <span className="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                            {selectedNode.industry}
                          </span>
                        </div>
                        
                        {selectedNode.expertise && (
                          <div>
                            <p className="text-sm text-gray-500 mb-2">主要专长</p>
                            <p className="text-sm text-gray-700">{selectedNode.expertise}</p>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  <div className="flex-1 bg-white relative">
                    <svg ref={svgRef} className="w-full h-full"></svg>
                    {currentView === 'network' && focusedPerson && (
                      <div className="absolute top-4 right-4 bg-white rounded-lg shadow p-3 text-sm">
                        <h3 className="font-bold mb-2">科技树视图</h3>
                        <div className="space-y-1 text-xs">
                          <p className="text-gray-600">中心节点：{focusedPerson.name}</p>
                          <p className="text-gray-500">枝干表示关系强度</p>
                          <p className="text-gray-500">点击节点查看详情</p>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          );
        };

        // 渲染应用
        ReactDOM.render(<NetworkVisualization />, document.getElementById('root'));
    </script>
</body>
</html>
